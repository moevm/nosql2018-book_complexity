<!DOCTYPE html>
<html lang="en">

  <head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Books complexity online</title>

    <!-- Bootstrap core CSS -->
    <link href="../vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="../css/book-analysis-style.css" rel="stylesheet">
  </head>

  <body onload="ajaxDataGet()">

    

    <!-- Header with Background Image -->
    <header class="business-header"></header>

    <!-- Page Content -->
    <div class="container">
      <img class="book-image-block" src="../img/empty-img.png">
      <!-- <img class="ngram-image-block" src="../img/ngram-image.jpg"> -->
      <div id="graphic" class="ngram-image-block"></div>

      <div class="book-characteristics">
        <div id="name"></div>
        <div id="auth"></div>
        <div id="uwords"></div>
        <div id="nwords"></div>
        <div id="complexity"></div>
       
        <!-- Complexity: &nbsp;&nbsp; <img class="stars" src="../img/rating35.png"><br> -->
      </div>

      <a href="../index.html"><img class="arrow md-10 lg-9 xl-8 mx-auto" src="../img/arrow.png" alt="arrow image"></a>
    </div>
    
    

    <!-- Bootstrap core JavaScript -->
    <script src="../vendor/jquery/jquery.min.js"></script>
    <script src="../vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="../vendor/plotly-latest.min.js"></script>
    <script>

      function ajaxDataGet() {
        var url_string = window.location.href; 
        var url = new URL(url_string);
        var bookName = url.searchParams.get("title");
        var bookAuthor = url.searchParams.get("chosenBookAuthor");
        
        var xhttp = new XMLHttpRequest();

        xhttp.open("POST", "/BookAnalysisServlet", true);
        xhttp.setRequestHeader("Content-type", "application/x-www-form-urlencoded");
        xhttp.send("title=" + bookName + "&author=" + bookAuthor);

        

        xhttp.onreadystatechange = function() {
          if (this.readyState == 4 && this.status == 200) {
            var jsonData = JSON.parse(this.responseText);
            var dif = jsonData.difficulty 
            console.log("succsess ");
            drawGraphic(jsonData.lexicon_years);
          
            document.getElementById('name').innerHTML = 'Name: &nbsp;&nbsp;"' + jsonData.title + '"<br>';
            document.getElementById('auth').innerHTML = 'Author: &nbsp;&nbsp;"' + jsonData.author + '"<br>';
            document.getElementById('uwords').innerHTML = 'Unique words: &nbsp;&nbsp;' + jsonData.unique_words_count + '<br>';
            document.getElementById('nwords').innerHTML = 'Number of words: &nbsp;&nbsp;' + jsonData.words_count + '<br>';
            
            if (dif < 0.75) {
              document.getElementById('complexity').innerHTML = 'Complexity: &nbsp;&nbsp; <img class="stars" src="../img/rating05.png">' + '<br>';  
            } else if (dif < 1.25) {
              document.getElementById('complexity').innerHTML = 'Complexity: &nbsp;&nbsp; <img class="stars" src="../img/rating10.png">' + '<br>';  
            } else if (dif < 1.75) {
              document.getElementById('complexity').innerHTML = 'Complexity: &nbsp;&nbsp; <img class="stars" src="../img/rating15.png">' + '<br>';  
            } else if (dif < 2.25) {
              document.getElementById('complexity').innerHTML = 'Complexity: &nbsp;&nbsp; <img class="stars" src="../img/rating20.png">' + '<br>';  
            } else if (dif < 2.75) {
              document.getElementById('complexity').innerHTML = 'Complexity: &nbsp;&nbsp; <img class="stars" src="../img/rating25.png">' + '<br>';  
            } else if (dif < 3.25) {
              document.getElementById('complexity').innerHTML = 'Complexity: &nbsp;&nbsp; <img class="stars" src="../img/rating30.png">' + '<br>';  
            } else if (dif < 3.75) {
              document.getElementById('complexity').innerHTML = 'Complexity: &nbsp;&nbsp; <img class="stars" src="../img/rating35.png">' + '<br>';  
            } else if (dif < 4.25) {
              document.getElementById('complexity').innerHTML = 'Complexity: &nbsp;&nbsp; <img class="stars" src="../img/rating40.png">' + '<br>';  
            } else if (dif < 4.75) {
              document.getElementById('complexity').innerHTML = 'Complexity: &nbsp;&nbsp; <img class="stars" src="../img/rating45.png">' + '<br>';  
            } else {
              document.getElementById('complexity').innerHTML = 'Complexity: &nbsp;&nbsp; <img class="stars" src="../img/rating50.png">' + '<br>';  
            }
            
            
                        
          }
          else {
            console.log(this.status)
          }
        };
      }

      function drawGraphic(dataArray){
        var xArr = new Array();
        var yArr = new Array();

        var arrayLength;
        
        if (dataArray.length > 52){
          arrayLength = 52;
        } else {
          arrayLength = dataArray.length;
        }

        for (var i = 0; i < arrayLength; i++) {
            yArr[i] = dataArray[i] * 100 / 255;
            xArr[i] = 1500 + i * 10;
        }

        var trace1 = {
        
            y: yArr,
            x: xArr,
            type: 'scatter'
        };


        var data = [trace1];

        Plotly.newPlot('graphic', data);
      }
      
    </script>

  </body>

</html>
